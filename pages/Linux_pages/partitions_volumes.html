<!DOCTYPE html>
<style>
	
</style>
<html>
  <meta name="viewport" content="width=device-width, initial-scale=1"> The following content was taken almost verbatim from pages 30 and 31 of <em>Linux Pro Magazine Special - Linux Shell Handbook - 2021 Edition</em>
  <h1 id="device-partitions-and-volumes">Device partitions and volumes</h1>
  <p>A hard disk on a modern computer is usually divided into partitions. A partition can contain exactly one filesystem (the data structure that stores files and directories). In Linux, swap space is usually implemented as a filesystem of its own, requiring its own partition. Additionally, many users create separate partitions for the <em>/boot</em>, <em>/var</em>, and <em>/home</em> directories. In theory, although Linux can be installed on one partition, likely you&#39;ll find multiple partitions. </p>
  <p>Before you can install an operating system, you need to create partitions and format them with filesystems. Most Linux installers provide a GUI for creating and managing partitions during the installation process, but if your system is already installed, you can turn to several management utilities for configuring partitions. The Bash command line provides several utilities for creating and configuring partitions, including <em>fdisk</em>, <em>gdisk</em>, and <em>parted</em>. </p>
  <p>These tools are all generally safe, but accidents such as power interruptions can happen, so be extremely careful. Before beginning, backup your data. Then boot from a Live disk so all your hard drive partitions are unmounted before you edit them. Most of all, check all your actions twice before beginning them.</p>
  <h2 id="mbr-to-gpt-switch">MBR to GPT Switch</h2>
  <p>A disk is divided into sections called partitions. Until recently, information on the partition structure was stored in a small sector at the beginning of the disk known as the Master Boot Record (MBR). </p>
  <p>The old MBR served the hard disk industry well, but the industry outgrew it. MBR-based disks could only have four primary partitions, and the size of a partition was limited to 2TB (once an impossibly large size but today sometimes severely limiting). The Unified Extensible Firmware Interface (UEFI) standard, which has rapidly gained acceptance in recent years, defines a new format for specifying partition information known as the GUID Partition Table (GPT). As older PCs are gradually replaced, GPT-based disks are gradually replacing MBR-based disks.</p>
  <h2 id="fdisk-for-mbr-partitions">fdisk for MBR partitions</h2>
  <p>The <em>fdisk</em> utility lets you create and manage partitions on MBR-based disks. Fdisk has two basic modes: interactive and non-interactive. Non-interactive mode queries a partition and displays the information. By contrast, interactive mode is menu driven and lets you alter, as well as explore, partitions and partition tables. </p>
  <p>Running <em>fdisk -l</em> prints a listing of the partition tables of all of the drives on the system. To use <em>fdisk</em>, you might need to preface it with <em>su</em> or <em>sudo</em> to attain root privileges, depending on your distribution. To view only a single drive&#39;s table, append the drive name to the command:</p>
  <pre>
			<code class="lang-bash">fdisk -l 
				<span>/dev/sda</span>
                        </code>
		</pre>
  <p>==Note that <em>fdisk</em> requires a drive as its device argument. Fdisk&#39;s output includes the total drive size and basic geometry, then lists the partitions on the drive and their start and end locations, size, and partition type (both by name and by ID number). Size is reported in blocks. By adding the <em>-u</em> flag, you can have <em>fdisk</em> report start and end locations in sectors instead of cylinders. Running </p>
  <pre>
			<code class="lang-bash">fdisk -s 
				<span>&lt;/some/device&gt;</span>
                        </code>
		</pre>
  <p>prints only the size of the device, but it works for both drives and partitions. To create or change partitions with <em>fdisk</em>, start it in interactive mode: Omit both the <em>-l</em> and <em>-s</em> flags, and specify a drive, such as </p>
  <pre>
  <code class="lang-bash">
    fdisk <span>/dev/hda</span><br>
    fdisk -u <span>/dev/sdc</span>
  </code>
		</pre>
  <p>The program writes its output to the screen and provides a command prompt but does not provide paging (e.g., <em>less</em>), so you might need to scroll up to read lengthy output. Entering <em>m</em> at the prompt list the available fdisk commands. From the main menu, you can create new partitions ( <em>n</em>), delete existing partitions ( <em>d</em>), verify the partition table ( <em>v</em>), and set several flags (the most notable being the bootable flag, toggled with <em>a</em>). To apply any changes, write a new partition table to the drive by entering <em>w</em>. At any time, you can quit without writing the partition table with <em>q</em>.== </p>
  <p>Creating a partition is a multistep process. Type <em>n</em> to begin, and fdisk will ask whether you want to create a primary partition ( <em>p</em>) or an extended partition ( <em>e</em>). Whichever you choose, fdisk will then ask you to select the partition number (be careful to choose an unused one if you have already created several), the location on the drive where you want the partition to start, and its size.== </p>
  <p>Fdisk will prompt you with the number of the first available cylinder on the drive. To leave an empty space between partitions, choose a higher number, which could help if you ever need to resize your partition.</p>
  <h2 id="gdisk-for-gpt-partitions">gdisk for GPT Partitions</h2>
  <p>The new UEFI standard replaces the old MBR with the new GPT format, which solves some of the problems associated with the MBR, supporting a much larger disk size and theoretically allowing up to 128 partitions on a disk.</p>
  <p>Because GPT uses a different format for storing partition information, it requires a different utility. The most popular options for the Linux command line are the GPT fdisk utilities <em>gdisk</em>, <em>sgdisk</em>, and <em>fixparts</em>. The GPT fdisk toolset comes standard on several contemporary Linux systems; if you don&#39;t find it, install it through your distro&#39;s packagement system. Once you have installed the GPT toolset, you can use it to check and modify the disk. The <em>gdisk</em> command here returns what follows for a new disk: </p>
  <pre>
			<code class="lang-bash">gdisk <span>/dev/sdh</span><br><br>

                         Partition table scan:<br>
				&nbsp; <span>MBR:</span> not present<br>

				&nbsp; <span>BSD:</span> not present<br>

				&nbsp; <span>APM:</span> not present<br>

				&nbsp; <span>GPT:</span> not present

                         </code>
		</pre>
  <p>Several choices for managing the partition table appear in the text mode menu. For instance, choosing the <em>p</em> option prints the partition table, whereas <em>o</em> first outputs a security prompt and then creates a GPT table. The <em>n</em> option lets you create a new disk-sized data partition. The <em>w</em> option writes the data (saves the changes) from the gdisk session. </p>
  <p>Gdisk can convert MBR-partitioned hard disks to GPT, which removes the need to back up and restore existing partition content. Choosing <em>r</em> sends you to the recovery and transformation menu, which offers options for converting your MBR disk to GPT. Gdisk can also convert from GPT to MBR. In some cases, this option will not work, so be sure to back up your data if you try it. </p>
  <h2 id="gnu-parted">GNU Parted</h2>
  <p>Fdisk is one of the older Linux tools, and Gdisk is modeled after it. Increasingly, many users prefer GNU Parted.</p>
  <p>You can run <em>parted</em> in interactive or non-interactive mode. The non-interactive syntax is <em>parted </some /device>
      <command>
    </em>. Running the command</p>
  <pre>
			<code class="lang-bash">parted 
				<span class="hljs-regexp">/dev/</span>sda 
				<span class="hljs-keyword">print</span>
			</code>
		</pre>
  <p>prints the partition table found on the <em>/dev/sda</em> disk. The information displayed is similar to fdisk&#39;s. </p>
  <p>Providing the <em>-i</em> flag before the device and command arguments launches <em>parted</em> in interactive mode. Unlike <em>fdisk</em>, however, you can create and modify partitions in non-interactive mode as well. </p>
  <p>One important difference between between <em>parted</em> and <em>fdisk</em> and <em>gdisk</em> is that <em>parted</em> commands take effect immediately; that is when you create a new partition table, the existing partition table (if any) on the target drive is overwritten. This leaves little margin for error when working with a drive that has existing partitions and can leave you hunting for recovery tools (fortunately, Parted can assist in that task as well). The command </p>
  <pre>
			<code class="lang-bash">parted &lt;/
				<span class="hljs-keyword">some</span>/device&gt; mklabel &lt;
				<span class="hljs-keyword">type</span>&gt;

			</code>
		</pre>
  <p>creates a new partition table on the specified device. You must specify the partition table type; for Linux, a widely used type is <em>msdos</em>, although Parted supports several others. To create a new partition, use: </p>
  <pre>
			<code class="lang-bash">parted 
				<span class="hljs-tag">&lt;/
					<span class="hljs-name">some</span>/
					<span class="hljs-attr">device</span>&gt;
				</span> mkpart 
				<span class="hljs-tag">&lt;
					<span class="hljs-name">partition_type</span>&gt;
				</span>
				<span class="hljs-tag">&lt;
					<span class="hljs-name">filesystem_type</span>&gt;
				</span>
				<span class="hljs-tag">&lt;
					<span class="hljs-name">start</span>&gt;
				</span>
				<span class="hljs-tag">&lt;
					<span class="hljs-name">end</span>&gt;
				</span>
			</code>
		</pre>
  <p>where <em>partition_type</em> is <em>primary</em>, <em>extended</em>, or <em>logical</em>. For primary or logical partitions, you must also specify <em>filesystem_type</em>, the filesystem format that the partition will hold. </p>
  <p>However, the <em>mkpart</em> command does not actually create the filesystem. To do so, use <em>mkpartfs</em> instead. Parted supports many common filesystems, including ext4, FAT32, NTFS, JFS, UFS, XFS, and Linux swap. The start and end parameters specify the location of the new partition on the disk; you do not have to use disk geometry such as sectors, but you can provide human-readable sizes expressed in megabytes. </p>
  <p>To remove a partition, use <em>parted </some /device> rm <N>
    </em>, where <em>
      <N>
    </em> is the partition number. </p>
  <p>Parted really improves on <em>fdisk</em> in its ability to move and resize partitions. For variety&#39;s sake, start Parted in interactive mode before exploring partition manipulation. You still need a drive device argument, such as </p>
  <pre>
				<code class="lang-bash">parted -
					<span class="hljs-selector-tag">i</span> /dev/hdb

				</code>
			</pre>
  <p>While in interactive mode, the device given as an argument is assumed; you do not need to include it in the commands you type. To switch to a different device within interactive mode, type</p>
  <pre>
				<code class="lang-bash">
					<span class="hljs-keyword">select</span> &lt;
					<span class="hljs-keyword">some</span>/other/device&gt;

				</code>
			</pre>
  <p>at the Parted command prompt.</p>
  <p>The <em>resize</em> command takes three arguments: the partition number, the new start location of the resized partition, and the new end location. To continue the above example, running </p>
  <pre>
				<code class="lang-bash">resize 
					<span class="hljs-number">1</span>
					<span class="hljs-number">0</span>
					<span class="hljs-number">1000</span>
				</code>
			</pre>
  <p>at the prompt would resize the partition at <em>/dev/hdb1</em> to begin at the start of the drive and end at the 1000MB mark. </p>
  <p>You can use Parted both to grow and shrink partitions. However, for ext2/3 filesystems, you cannot change the start location with a <em>resize</em> command, only the end. That restriction does not apply to the other filesystems that Parted supports. </p>
  <p>Parted can move a partition to a new free location on a drive with the <em>move</em> command. The syntax is </p>
  <pre>
				<code class="lang-bash">
					<span class="hljs-keyword">move</span>
					<span class="hljs-symbol">&lt;partitionNumber&gt;</span>
					<span class="hljs-symbol">&lt;start&gt;</span>
					<span class="hljs-symbol">&lt;end&gt;</span>
				</code>
			</pre>
  <p>although <em>
      <end>
    </em> is optional. If omitted, the partition is moved to the new location in its original size. If an ending point defines a new size for the partition, Parted automatically resizes as well as moves it. </p>
  <p>When shuffling and resizing partitions, you might need to duplicate a partition in a new location, perhaps to move a partition to a new device in an attempt to free up space. At the Parted prompt, use</p>
  <pre>
					<code class="lang-bash">cp 
						<span class="hljs-tag">&lt;
							<span class="hljs-name">original</span>/
							<span class="hljs-attr">device</span>&gt;
						</span>
						<span class="hljs-tag">&lt;
							<span class="hljs-name">originalPartition</span>&gt;
						</span>
						<span class="hljs-tag">&lt;
							<span class="hljs-name">targetPartition</span>&gt;
						</span>
					</code>
				</pre>
  <p>where <em>/orginal/device</em> is optional; if omitted, the current working device will be assumed. Thus, the command </p>
  <pre>
					<code class="lang-bash">cp /dev/sdb 
						<span class="hljs-number">5</span>
						<span class="hljs-number">1</span>
					</code>
				</pre>
  <p>copies the <em>/dev/sdb5</em> partition to <em>/dev/hdb1</em>. </p>
  <p>If you accidentally delete a partition from the partition table or overwrite the partition table itself, entering</p>
  <pre>
					<code class="lang-bash">rescue 
						<span class="hljs-tag">&lt;
							<span class="hljs-name">start</span>&gt;
						</span>
						<span class="hljs-tag">&lt;
							<span class="hljs-name">end</span>&gt;
						</span>
					</code>
				</pre>
  <p>initiates a search for filesystem signatures on the disk. Parted searches a range of sectors around the start and end positions for signs of the filesystem, so you do not need to be exact. If it finds a potential filesystem in the appropriate location, Parted asks whether you want to create a new partition. For this rescue to work, the filesystem must be more or less intact; Parted can only recreate partition table entries - to fix filesystem corruption, you need other tools.</p>
  <h2 id="the-lvm-alternative">The LVM Alternative</h2>
  <p>A Logical Volume Manager (LVM) is an alternative to traditional partitioning that treats the space on one drive - or even multiple drives - as a single unit and divides it into logical volumes. GNU Parted also works with LVMs. </p>
  <p>The use of LVMs may come at a price: Should a drive become corrupt, your entire system suddenly can be inaccessible. By contrast, if you use traditional partitions, especially for <em>/home</em>, you might be able to recover data by booting from a Live device after the root or boot partition crashes. You should research the difference between LVMs and traditional partitioning carefully before deciding which to use. </p>
